
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Fengyu Cai</title>
	<meta name="author" content="Fengyu">

	
	<meta name="description" content="最近看学习CLRS “红黑树”一章的时候遇到了麻烦：虽然作者给出了详细的介绍和严谨的证明，
但是看完后仍然是一头雾水，而且400多行伪代码也是不小的记忆负担。无意中发现刘未鹏的博客
文章知其所以然（以算法学习为例）
也提到了这个问题，于是找来红黑树发明者Sedgewick的PPT讲解， &hellip;">
	

	<link href="/atom.xml" rel="alternate" title="Fengyu Cai" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
	

	
</head>

<body>
	<header id="header" class="inner"><nav><ul>
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>
</nav>
</header>
	<div id="content" class="inner">


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/02/16/rbtree/">最简洁的红黑树实现</a></h1>
  
  








	
		<time datetime="2014-02-16T23:30:00+08:00">
			<span class="day">16</span><span class="month">Feb</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p><img src="/images/linkedlist.png">
最近看学习CLRS “红黑树”一章的时候遇到了麻烦：虽然作者给出了详细的介绍和严谨的证明，
但是看完后仍然是一头雾水，而且400多行伪代码也是不小的记忆负担。无意中发现刘未鹏的博客
文章<a href="http://mindhacks.cn/2008/07/07/the-importance-of-knowing-why/">知其所以然（以算法学习为例）</a>
也提到了这个问题，于是找来红黑树发明者Sedgewick的PPT讲解，终于醍醐灌顶：原来红黑树
背后的idea是2-3-4树，最简单又相对高效的实现是Sedgewick讲的Left-leaning RB Tree。
PPT戳这里<a href="http://fengyucai.github.io/images/RedBlack.pdf">LLRB</a></p>

<p>我用C++实现的红黑树如下，只有150来行代码。如有错误欢迎指出：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#ifndef RED_BLACK_BST</span>
</span><span class='line'><span class="cp">#define RED_BLACK_BST</span>
</span><span class='line'><span class="cp">#define BLACK false</span>
</span><span class='line'><span class="cp">#define RED true</span>
</span><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RedBlackBST</span> <span class="p">{</span>
</span><span class='line'><span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="n">RedBlackBST</span><span class="p">()</span> <span class="o">:</span> <span class="n">root</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">RedBlackBST</span><span class="p">(</span><span class="k">const</span> <span class="n">RedBlackBST</span> <span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">root</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>    <span class="o">~</span><span class="n">RedBlackBST</span><span class="p">()</span> <span class="p">{</span> <span class="n">makeEmpty</span><span class="p">(</span><span class="n">root</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>    <span class="kt">void</span> <span class="n">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">remove</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>    <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">root</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">private</span><span class="o">:</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">Node</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">T</span> <span class="n">key</span><span class="p">;</span>
</span><span class='line'>        <span class="n">Node</span> <span class="o">*</span><span class="n">left</span><span class="p">;</span>
</span><span class='line'>        <span class="n">Node</span> <span class="o">*</span><span class="n">right</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">bool</span> <span class="n">color</span><span class="p">;</span>
</span><span class='line'>        <span class="n">Node</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span> <span class="n">k</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">l</span><span class="o">=</span><span class="k">nullptr</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">r</span><span class="o">=</span><span class="k">nullptr</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">c</span><span class="o">=</span><span class="n">BLACK</span><span class="p">)</span><span class="o">:</span>
</span><span class='line'>        <span class="n">key</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">left</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">right</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">color</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">bool</span> <span class="nf">isRed</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">?</span> <span class="n">x</span><span class="o">-&gt;</span><span class="nl">color</span> <span class="p">:</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">rotateLeft</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Node</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">;</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>
</span><span class='line'>        <span class="n">x</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>        <span class="n">x</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">;</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="n">RED</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">rotateRight</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Node</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">;</span>
</span><span class='line'>        <span class="n">x</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>        <span class="n">x</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">;</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="n">RED</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// Split 4-node</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">colorFlip</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="o">!</span> <span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">);</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">);</span>
</span><span class='line'>        <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">color</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">fixUp</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">))</span>
</span><span class='line'>            <span class="n">h</span> <span class="o">=</span> <span class="n">rotateLeft</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span>
</span><span class='line'>            <span class="n">h</span> <span class="o">=</span> <span class="n">rotateRight</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">))</span>
</span><span class='line'>            <span class="n">colorFlip</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// 2-3 tree insert</span>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">insert</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">RED</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>            <span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&gt;</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>            <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">fixUp</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// Deletion</span>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">remove</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>           <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span>
</span><span class='line'>               <span class="n">h</span> <span class="o">=</span> <span class="n">moveRedLeft</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>           <span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="n">remove</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span> <span class="n">h</span> <span class="o">=</span> <span class="n">rotateRight</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">key</span> <span class="o">&amp;&amp;</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">delete</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span>
</span><span class='line'>                <span class="n">h</span> <span class="o">=</span> <span class="n">moveRedRight</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">h</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">h</span><span class="o">-&gt;</span><span class="n">key</span> <span class="o">=</span> <span class="n">minimum</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">;</span>
</span><span class='line'>                <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">removeMin</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span>
</span><span class='line'>                <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">remove</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">fixUp</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>   <span class="c1">// Helper functions</span>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">moveRedRight</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">colorFlip</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">h</span> <span class="o">=</span> <span class="n">rotateRight</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>            <span class="n">colorFlip</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">moveRedLeft</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">colorFlip</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span> <span class="o">=</span> <span class="n">rotateRight</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
</span><span class='line'>            <span class="n">h</span> <span class="o">=</span> <span class="n">rotateLeft</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>            <span class="n">colorFlip</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">removeMin</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>           <span class="k">delete</span> <span class="n">h</span><span class="p">;</span>
</span><span class='line'>           <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>       <span class="p">}</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isRed</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">))</span>
</span><span class='line'>           <span class="n">h</span> <span class="o">=</span> <span class="n">moveRedLeft</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>       <span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">=</span> <span class="n">removeMin</span><span class="p">(</span><span class="n">h</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
</span><span class='line'>       <span class="k">return</span> <span class="n">fixUp</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">minimum</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">left</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span>
</span><span class='line'>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Node</span><span class="o">*</span> <span class="nf">clone</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span>
</span><span class='line'>           <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>       <span class="k">else</span>
</span><span class='line'>           <span class="k">return</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">,</span> <span class="n">clone</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">),</span> <span class="n">clone</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">),</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">color</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">makeEmpty</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="o">&amp;</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">makeEmpty</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
</span><span class='line'>            <span class="n">makeEmpty</span><span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
</span><span class='line'>            <span class="k">delete</span> <span class="n">t</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">t</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="cp">#endif</span>
</span></code></pre></td></tr></table></div></figure>


  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/datastructures/'>datastructures</a></div>

    
  </footer>
  
</div>
</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/01/05/linkedlist/">关于Linked List的奇技淫巧</a></h1>
  
  








	
		<time datetime="2014-01-05T21:16:00+08:00">
			<span class="day"> 5</span><span class="month">Jan</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p><img src="/images/linkedlist.png"></p>

<p>单链表是一种十分简单的数据结构，然而基本操作的组合可以衍生出不少tricky的问题。
定义单链表的结构如下(C++11):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">node</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>      <span class="n">T</span> <span class="n">data</span><span class="p">;</span>
</span><span class='line'>      <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">next</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reverse Linked List</h2>

<p>一种常见的操作是链表的反转。最自然的实现方式是使用递归：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">reversed_linked_list</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">head</span> <span class="o">||</span> <span class="o">!</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">head</span><span class="p">;</span>
</span><span class='line'>  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">new_head</span> <span class="o">=</span> <span class="n">reversed_linkded_list</span><span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">);</span>
</span><span class='line'>  <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
</span><span class='line'>  <span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">new_head</span><span class="p">;</span>   
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>然而这种方法的缺点是需要O(n)的栈空间。因为不是尾递归，编译器无法把代码优化成迭代的形式。
迭代的方法只需O(1)的额外空间，利用了prev和curr两个指针：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">reversed_linked_list</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">prev</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">curr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>      <span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">prev</span><span class="p">;</span>
</span><span class='line'>      <span class="n">prev</span> <span class="o">=</span> <span class="n">curr</span><span class="p">;</span>
</span><span class='line'>      <span class="n">curr</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">prev</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Find the Middle Point of LinkedList</h2>

<p>求一个单链表的中间结点利用了pre_slow, slow和fast三个指针:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">slow</span> <span class="o">=</span> <span class="n">fast</span> <span class="o">=</span> <span class="n">L</span><span class="p">,</span> <span class="n">pre_slow</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'><span class="k">while</span> <span class="p">(</span><span class="n">fast</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">fast</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pre_slow</span> <span class="o">=</span> <span class="n">slow</span><span class="p">;</span>
</span><span class='line'>      <span class="n">slow</span> <span class="o">=</span> <span class="n">slow</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>      <span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Zipping A Linked List</h2>

<p>更难的问题是求链表的&#8221;zip&#8221;。
给定一个单链表(L0, L1,&hellip;Ln-1)，定义链表的“zip&#8221;为(L0, Ln-1, L1, Ln-2&hellip;)。
求zip的过程由三个基本操作组合而成，除了上面提到的两个，还有一个基本操作是
将一个链表表头结点连接到另一个链表，可以抽象成如下的子过程：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="kt">void</span> <span class="n">connect_a_next_to_b_advance_a</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span>
</span><span class='line'>                                 <span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>  <span class="n">a</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span><span class='line'>  <span class="n">a</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>完整的Zipping过程如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">zipping_linked_list</span><span class="p">(</span><span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span> <span class="n">L</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Find the middle point of the linked list</span>
</span><span class='line'>  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">slow</span> <span class="o">=</span> <span class="n">L</span><span class="p">,</span> <span class="n">fast</span> <span class="o">=</span> <span class="n">L</span><span class="p">,</span> <span class="n">pre_slow</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">fast</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">fast</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">pre_slow</span> <span class="o">=</span> <span class="n">slow</span><span class="p">;</span>
</span><span class='line'>          <span class="n">slow</span> <span class="o">=</span> <span class="n">slow</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>          <span class="n">fast</span> <span class="o">=</span> <span class="n">fast</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// The list only contains one node</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pre_slow</span><span class="p">)</span> <span class="k">return</span> <span class="n">L</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// Split the list into two lists</span>
</span><span class='line'>  <span class="n">pre_slow</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span><span class='line'>  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">reverse</span> <span class="o">=</span> <span class="n">reversed_linked_list</span><span class="p">(</span><span class="n">slow</span><span class="p">),</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">L</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// Zipping the list</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">curr</span> <span class="o">&amp;&amp;</span> <span class="n">reverse</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">connect_a_next_to_b_advance_a</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">reverse</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">curr</span><span class="p">)</span> <span class="n">connect_a_next_to_b_advance_a</span><span class="p">(</span><span class="n">reverse</span><span class="p">,</span> <span class="n">curr</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">L</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>关于链表还有许多变式的问题，解决的关键在于把原问题分解成子过程，还要考虑各种边界情况：
比如空链表，长度为1的链表，奇偶长度的链表等等。</p>

  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/datastructures/'>datastructures</a></div>

    
  </footer>
  
</div>
</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2013/12/13/tan-suo-uitableviewcellde-zhong-yong-ji-zhi/">探索UITableViewCell的重用机制</a></h1>
  
  








	
		<time datetime="2013-12-13T12:53:00+08:00">
			<span class="day">13</span><span class="month">Dec</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p><img src="/images/reuseCell.png"></p>

<p>为了充分利用iOS设备有限的内存，UITableView这个API的设计巧妙地利用了这样一个事实：
尽管一个table可能需要显示成千上万个cell的数据, 但在有限的屏幕空间上，用户只能看见当前显示的cell。因此，UITableView采用按需创建cell的策略，随着table的滑动，前面不再可见的cell会被加入一个缓存队列, 当后面新的一行数据需要显示时，可以重用队列中的旧的cell内存来存放数据，如果队列为空，则分配内存新创建一个UITableViewCell对象。</p>

<p>假设一个UITableView有100000行数据，实际上需要创建的UITableViewCell对象有多少个呢？
下面的代码让您更直观地理解cell的重用机制。您可以自己创建一个UITableViewController
并实现相应的方法来验证。</p>

<p>首先在MyViewController.h中声明一个cellCount属性。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">MyViewController</span> : <span class="bp">UITableViewController</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">myData</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">NSUInteger</span> <span class="n">cellCount</span><span class="p">;</span> <span class="c1">// 记录新创建的cell的数量</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在MyViewController.m中实现如下方法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import “MyViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">MyViewController</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">myData</span><span class="p">,</span> <span class="n">cellCount</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>    <span class="n">cellCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">myData</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="bp">NSUInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="bp">NSString</span> <span class="o">*</span><span class="n">dataString</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;Item %lu&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">myData</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">dataString</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;The array contains %lu items&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">myData</span> <span class="n">count</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">-(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>
</span><span class='line'>    <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">myData</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>
</span><span class='line'>    <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">cellIndentifier</span> <span class="o">=</span> <span class="s">@&quot;Cell&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier</span><span class="p">:</span><span class="s">@&quot;Cell&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span>
</span><span class='line'>                                       <span class="nl">reuseIdentifier</span><span class="p">:</span><span class="n">cellIndentifier</span><span class="p">];</span>
</span><span class='line'>        <span class="o">++</span><span class="nb">self</span><span class="p">.</span><span class="n">cellCount</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">myData</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;There are actually %lu new cells now”, cellCount);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>假设一个tableView视图最多只能完整显示10个cell, 以上代码的输出如图：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>The array contains 100000 items
</span><span class='line'>There are actually 1 new cells now
</span><span class='line'>There are actually 2 new cells now
</span><span class='line'>There are actually 3 new cells now
</span><span class='line'>There are actually 4 new cells now
</span><span class='line'>There are actually 5 new cells now
</span><span class='line'>There are actually 6 new cells now
</span><span class='line'>There are actually 7 new cells now
</span><span class='line'>There are actually 8 new cells now
</span><span class='line'>There are actually 9 new cells now
</span><span class='line'>There are actually 10 new cells now
</span><span class='line'>There are actually 11 new cells now
</span><span class='line'>There are actually 11 new cells now
</span><span class='line'>……</span></code></pre></td></tr></table></div></figure>


<p>我们观察到无论怎样向下滑动tableView，至多只有11个cell被创建！最开始分配的cell内存被后来的数据行反复利用。
这种机制的确很好地利用了内存空间。
为什么是11个而不是10个呢？如下图所示，在刚开始向下滑动的某一瞬间, 第1行数据Item0的cell仍有部分可见，
此时缓存队列为空，为了显示第11行，UITableView创建了第11个cell对象。这也是最后一个新建的cell。
当第1行数据完全不可见时，第1个cell入队列, 接下来需要显示的第12行则重用了队列中第一个cell的空间。
依此类推，无论table中有多少行数据，无论接下来如何滑动，每一个数据行都可以循环利用这11个cell对象的内存。</p>

<p><img src="/images/tableView.png"></p>

  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/ios/'>ios</a></div>

    
  </footer>
  
</div>
</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2013/12/08/wei-miao-de-ios-mvc/">微妙的 iOS MVC</a></h1>
  
  








	
		<time datetime="2013-12-08T20:23:00+08:00">
			<span class="day"> 8</span><span class="month">Dec</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p><img src="/images/mvc.png"></p>

<p>Cocoa的设计遵循了MVC的原则，然而相比其他的SDK，models, views和controllers三层之间的界限
并不明显。比如在Rails, Django一类的Web开发框架下，各个模块的代码被清晰地分离至不同的目录中。
但在iOS开发中, 您可以通过Interface Builder 创建views,  也可以选择在controllers模块内手写views的代码。
此外，views的数据往往来自models, 然而”models”可能来自Core Data管理的SQLite数据库，也可能
分布在ViewControllers一个NSArray的实例变量中，甚至可能在 viewDidLoad 方法中被动态地创建。
这种相对灵活的方式可能导致controllers中的代码变得复杂而冗长。特别是在一些需要大量读写数据库
和频繁访问远程网络的应用中，controllers模块常常变得难以维护。一个最佳实践就是把controllers中
请求逻辑(request logic)相关的代码分离出来，放到一个独立的”Store” 模块内，再由store来访问models
的数据，从而MVC模式进化成了MVCS模式。</p>

<p>因此，MVC只是一个概念上的框架，而不是一堆严格分类的目录和文件。接触了iOS后我对MVC
的设计模式有了更一步的理解，在平时的开发中也能更自然地运用MVC的方式来思考。</p>

  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/architecture/'>architecture</a></div>

    
  </footer>
  
</div>
</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2013/11/15/ios7layoutguide/">iOS 7中的topLayoutGuide与bottomLayoutGuide</a></h1>
  
  








	
		<time datetime="2013-11-15T18:52:00+08:00">
			<span class="day">15</span><span class="month">Nov</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>iOS界面顶部和底部的UI的通常由某种UIKit Bars构成, 比如状态栏(status bar),
导航条(navigation bar), 工具栏(tool bar)和标签栏(tab bar)。开发中常常需要
在顶部和底部bars之间的区域内布置一些UI元素。在iOS 6以及更早的版本中，一个
UIViewController会自动调整自身view的大小来适配这块中间区域。然而在iOS 7中，
一个UIViewController的view会在竖直方向上扩展至整个屏幕的边界，可能导致原来
view的子视图被顶部或底部的bars所覆盖(如下图)。</p>

<p><img src="/images/beforeguide.png"></p>

<p>为了解决这种新布局带来的问题，iOS 7的UIViewController增加了两个新的属性(property):
topLayoutGuide和bottomLayoutGuide。topLayoutGuide和bottomLayoutGuide实际上
位于顶部和底部的两个透明的视图，这两个视图的默认高度正是bars的高度，可以作为子视图嵌入
某个root view。下面以topLayoutGuide为例, 结合Auto layout, 我们可以通过编写代码
解决上述问题。</p>

<p>示例代码如下(其中的vc代表某个navigation controller的rootViewController):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="n">vc</span><span class="p">.</span><span class="n">view</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">v2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIView</span> <span class="n">new</span><span class="p">];</span>
</span><span class='line'>    <span class="n">v2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">v1</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">v2</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 关闭Autoresizing, 开启Auto layout</span>
</span><span class='line'>    <span class="n">v2</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 获取vc的topLayoutGuide视图</span>
</span><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">tlg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">vc</span><span class="p">.</span><span class="n">topLayoutGuide</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">vs</span> <span class="o">=</span> <span class="n">NSDictionaryOfVariableBindings</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">tlg</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 使子视图v2的宽度与v1相同</span>
</span><span class='line'>    <span class="p">[</span><span class="n">v1</span> <span class="nl">addConstraints</span><span class="p">:</span>
</span><span class='line'>    <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;H:|[v2]|&quot;</span>
</span><span class='line'>      <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">vs</span><span class="p">]];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 把v2放置在topLayoutGuide的下方，并设置v2高度为20</span>
</span><span class='line'>    <span class="p">[</span><span class="n">v1</span> <span class="nl">addConstraints</span><span class="p">:</span>
</span><span class='line'>    <span class="p">[</span><span class="bp">NSLayoutConstraint</span> <span class="nl">constraintsWithVisualFormat</span><span class="p">:</span><span class="s">@&quot;V:[tlg][v2(20)]&quot;</span>
</span><span class='line'>  <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">metrics</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">views</span><span class="p">:</span><span class="n">vs</span><span class="p">]];</span>
</span></code></pre></td></tr></table></div></figure>


<p>在模拟器运行的得到的效果图如下:</p>

<p><img src="/images/afterguide.png"></p>

<p>当然，您也可以在nib编辑器中通过调整各视图的constraints来达到同样的目的。</p>

  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/ios/'>ios</a></div>

    
  </footer>
  
</div>
</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2013/11/02/iosxue-xi-zong-jie-1-views/">iOS学习总结1: Views</a></h1>
  
  








	
		<time datetime="2013-11-02T21:32:00+08:00">
			<span class="day"> 2</span><span class="month">Nov</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>视图（View) 是UIView类或者UIView子类的实例。一个视图能够将自身绘制到界面的某个矩形区域内。
我们可以通过在nib编辑器中拖动控件来绘制视图，也可以部分或者全部通过代码来实现。自定义view的
代码可以控制视图出现(appear)，消失(disappear)，移动(move), 改变大小（resize) 甚至显示
一些动画效果(animation)。同时UIView也是UIResponder的子类，这意味着Views可以响应来自用户
的触摸事件，比如轻敲(tap) , 滑动(swipe), 长按(long press)等等。</p>

<p>应用中的Views是通过视图层次结构(view hierarchy)组织起来的。一个视图可以有多个子视图(subviews)，
但只能有一个直接父视图(superview)。当一个视图从界面中移除时，其子视图也会随着移除。一个视图移动,
其子视图也会跟着移动。视图层次结构是响应对象链(responder chain)的基础。</p>

<h2>UIWindow</h2>

<p>UIWindow实例位于视图层次结构的最顶部，UIWindow也是UIView的子类。UIWindow实例的
主要功能是为Views提供显示空间以及向其他Views分发事件。一般情况下应用只有唯一一个UIWindow实例，
它在app启动时创建并占据整个屏幕, 然后在程序的整个生命周期(lifetime)都一直存在。
App Delegate 类拥有一个window属性(property)，指向这个UIWindow实例。当应用启动时，
main.m文件中的UIApplicationMain被main函数调用，创建并初始化App Delegate实例。app
delegate实例也将一直存在于应用的整个生命周期里。在app delegate中创建UIWindow的代码示例如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">UIWindow</span><span class="o">*</span> <span class="n">w</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:[[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>子视图与父视图</h2>

<p>OS X 10.5之前，如果A视图不是B视图的子视图，则A视图的任何部分都不能出现在B视图的区域内。
Apple在OS X 10.5后采用更加灵活的规则，在iOS中允许视图之间互相覆盖(overlap), 无论
是否有父子关系。如图：</p>

<p><img src="/images/overlap.png"></p>

<p>因为overlap有多种可能的情形，我们并无法直接观察出以上三个视图的继承关系。事实上，
中间的视图和左边的视图是兄弟视图(siblings)，而右边视图是中间视图的子视图。
如果views是通过nib文件创建的，我们可以通过nib编辑器的outline区域查看它们之间的关系。
如图:</p>

<p><img src="/images/views.png"></p>

<p>另外，假设someView是根视图，则可以通过以下代码在控制台输出视图的层次结构：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSLog</span><span class="p">(@</span><span class="err">“</span><span class="o">%</span><span class="p">@</span><span class="err">“</span><span class="p">,</span> <span class="p">[</span><span class="n">someView</span> <span class="nl">performSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">recursiveDescription</span><span class="p">)]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>addSubview:方法使得一个视图成为另一视图的子视图，当addSubview:被调用时，传入参数的
视图对象会成为父视图subviews数组的最后一个元素，也就是最后一个绘制在屏幕上的子视图，
覆盖在所有子视图的最顶层。 为了更好地理解overlap的规则和视图之间的关系，我们可以新建
一个iOS Empty Application 项目, 通过以下代码实现上面三个视图的效果。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:[[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span><span class='line'>    <span class="c1">// Override point for customization after application launch.</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIViewController</span> <span class="n">new</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">mainView</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span><span class="p">.</span><span class="n">view</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">113</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">194</span><span class="p">)];</span>
</span><span class='line'>    <span class="n">v1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mf">0.4</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">1</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">v2</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">194</span><span class="p">)];</span>
</span><span class='line'>    <span class="n">v2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">0.5</span> <span class="nl">green</span><span class="p">:</span><span class="mi">1</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">UIView</span> <span class="o">*</span><span class="n">v3</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">230</span><span class="p">)];</span>
</span><span class='line'>    <span class="n">v3</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mi">0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">mainView</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">v1</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">v1</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">v2</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">mainView</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">v3</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">window</span> <span class="n">makeKeyAndVisible</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>未完待续</h2>

  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/ios/'>ios</a></div>

    
  </footer>
  
</div>
</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2013/11/01/rui-jie-xiao-yuan-wang-macke-hu-duan-deng-lu-wen-ti-de-jie-jue-fang-an/">锐捷校园网Mac客户端登录问题的解决方案</a></h1>
  
  








	
		<time datetime="2013-11-01T22:15:00+08:00">
			<span class="day"> 1</span><span class="month">Nov</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>由于多数同学之前没接触过命令行shell，建议下载完客户端后把文件[Ruijie Suppiant.app]拖曳到
Finder的应用程序目录下(如图)，接下来只要直接copy我贴出的命令，并粘贴到终端输入就可以了。</p>

<p><img src="/images/app.png"></p>

<h2>打开终端</h2>

<p>点击右上角的spotlight搜索并打开应用程序［终端］, 如图所示</p>

<p><img src="/images/terminal.png"></p>

<p>在终端输入以下命令, 注意每一行结束都要敲击一下回车[return]</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /Applications/Ruijie\ Supplicant.app/Contents/MacOS/
</span><span class='line'>sudo chmod 777 Supplicant</span></code></pre></td></tr></table></div></figure>


<p>然后在命令行提示下输入你当前用户的密码，敲击回车确认
(注意，在输入过程中password:后面不会显示任何字符, 保证输入无误并敲击回车即可。
如果发觉已输错,按住delete键清空并再次输入)
再次输入以下命令运行Supplicant二进制文件</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./Supplicant</span></code></pre></td></tr></table></div></figure>


<p>这时你应该可以看到如下界面。
正确选择网卡是关键的一个步骤。如何确认你已经选择了正确的网卡呢？</p>

<p><img src="/images/network.png"></p>

<p>点击导航条左上角苹果的logo, 点击关于本机-更多信息－系统报告</p>

<p><img src="/images/BSD.png"></p>

<p>如图所示，选中[硬件]下拉列表中的[以太网卡]选项，查看右边的BSD名称，请确认你在客户端下拉菜单
选择的网卡名称与BSD名称一致。然后就可以点击连接了。如果可以成功连上，那么恭喜你，不用继续
往下看了，最后在Dock中保留锐捷的图标就OK了。</p>

<h2>权限的问题</h2>

<p>部分同学反映点击连接后会出现找不到网卡的提示，终端界面则出现了permission denied的警告，如图。</p>

<p><img src="/images/problem.png"></p>

<p>原因是一个ChmodBPF的启动项丢失导致了非root用户对文件/dev/bpf没有read/write权限，
由于系统每次重启都会重置/dev下文件的权限，每次登录都要在命令行下为bpf文件添加权限无疑是反人类的，ChmodBPF的作用正是在系统启动时帮你自动完成这个任务。解决方法如下：</p>

<h2>安装Xcode和Git</h2>

<p>因为接下来需使用git命令，首先请确认电脑上已经安装了Xcode和Git, Xcode可在App Store免费获取，</p>

<p>OS X的Git安装包传送门<a href="https://code.google.com/p/git-osx-installer/downloads/detail?name=git-1.8.4.2-intel-universal-snow-leopard.dmg&amp;can=3&amp;q=&amp;sort=-uploaded">git-1.8.4.2-intel-universal-snow-leopard.dmg</a></p>

<h2>获取ChmodBPF</h2>

<p>继续在终端下输入以下命令，从我的Github仓库中获取这个文件</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~
</span><span class='line'>sudo git clone git://github.com/cocoalover/ChmodBPF.git
</span><span class='line'>sudo cp -R ChmodBPF /Library/StartUpItems/ChmodBPF</span></code></pre></td></tr></table></div></figure>


<p>输入用户密码。首次运行git可能需要同意Apple的协议，按照文字提示
按下空格键浏览协议，并输入agree同意该协议, 当看到&#8221;Checking Connectivity&hellip;Done&#8221;
的提示后就可以输入上面的sudo cp命令。
完成后点击屏幕左上角苹果的logo, 点击 关于本机-更多信息－系统报告
选中[软件]菜单下的[启动项], 应该可以看到多了一个名称为ChmodBPF的启动项（如图）</p>

<p><img src="/images/startup.png"></p>

<h2>为当前用户添加一个群组</h2>

<p>打开系统偏好设置－用户与群组, 点击左下角的＋按钮添加一个名为access_bpf的群组，如图所示，
创建后记得勾选当前的用户名。</p>

<p><img src="/images/group.png"></p>

<h2>修改/dev目录下相关文件的群组</h2>

<p>继续在终端下输入:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /dev/
</span><span class='line'>sudo chgrp access_bpf bpf*</span></code></pre></td></tr></table></div></figure>


<p>重新启动计算机。。。
再次打开终端，输入以下命令运行锐捷客户端</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /Applications/Ruijie\ Supplicant.app/Contents/MacOS/
</span><span class='line'>./Supplicant</span></code></pre></td></tr></table></div></figure>


<p>确保正确填写认证信息后，应该就可以正常连上校园网了。
在Dock中保留Ruijie的图标，以后登录只需点击图标，不再需要和命令行界面打交道了。
童鞋们如果出现其他问题可以在评论中向我提问，有更好的解决方案也欢迎讨论。</p>

  
  
  <footer class="meta">
    



	<div class="tags"><a class='category' href='/blog/categories/networking/'>networking</a></div>

    
  </footer>
  
</div>
</article>

</div>
	<footer id="footer" class="inner"><div class="social alignright">
	
	
	
	
	
	<a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>&copy; 2015 Fengyu</p>
<div class="clearfix"></div></footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
	(function($){
		$('.entry-content').each(function(i){
			var _i = i;
			$(this).find('img').each(function(){
				var alt = $(this).attr('alt');

				if (alt == '' || typeof alt == 'undefined'){
					$(this).wrap('<a href="'+$(this).attr('src')+'" class="fancybox" rel="gallery'+_i+'" />');
				} else {
					$(this).after('<span class="caption">'+alt+'</span>').wrap('<a href="'+$(this).attr('src')+'" class="fancybox" title="'+alt+'" rel="gallery'+_i+'" />');
				}
			});
		});
		$('.fancybox').fancybox();
	})(jQuery);
</script>
<div id="phasebeam">
	<canvas></canvas>
	<canvas></canvas>
	<canvas></canvas>
</div>
<script src="/javascripts/phasebeam.js"></script>





</body>
</html>